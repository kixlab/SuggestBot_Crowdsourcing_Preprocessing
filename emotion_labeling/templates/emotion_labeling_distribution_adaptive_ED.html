{% extends 'emotion_labeling_distribution_example.html' %}

{% load staticfiles %}


{% block example_modal %}

<div id="example" class='modal' style="top:2.5%; width:80%; max-height:95%">
  <div class='modal-content row' style="padding:5px; height:90%; width: 100%; padding-bottom:0px; margin-bottom: 0px;">
    <h4>Example [[cur_ex+1]]</h4>
    <p style="margin-bottom: 5px">Below is the example that can be possibly similar to the video you are watching.</p>
    <p style="margin-bottom: 5px">Please refer to the video and how emotion labels are distributed,</p>
    <p style="margin-bottom: 5px">When you are deciding the histogram of emotion labels.</p>
    <div class="col s6" style="padding:0">
      <video id='vd' class="video-js vjs-default-skin vjs-big-play-centered" v-bind:style="{top: bar_video_top()}" style="height:270px; width:480px; position:relative;"></video>
      <span class='btn' v-on:click="play_pause()" v-bind:style="{top: bar_video_top()}" style="position: relative">
        <span v-if="!playing"><i class="material-icons">play_arrow</i></span>
      <span v-if="playing"><i class="material-icons">pause</i></span></span>
      <span class='btn red' v-on:click="to_beginning()" v-bind:style="{top: bar_video_top()}" style="position: relative"><i class="material-icons">replay</i></span>
    </div>
    <div class="col s6" style="padding: 0;">
      <div class="col s11" style="padding: 0;">
      <div id="valence_radios" class="row" style="margin-bottom: 0px;">
        <div class="table_radios row" style="display:block; margin:auto; margin-top: 5px; margin-bottom: 5px;">
          <span style="display:block; margin: auto;">Excited</span>
          <img id='excited_img' src="{%static 'img/valence_arousal/arousal_5.png'%}" class="guide_img" v-bind:style="{width: a_v_pic_width()}" style="display:block;  margin: auto;"></img>
        </div>
        <div class="row" style="display:block; margin:auto" id="table_row">
          <div class="table_radios col s1" style="position: relative;" v-bind:style="{top: a_v_pic_top()}">
            <span style="display:block; margin: auto;">Negative</span>
            <img src="{%static 'img/valence_arousal/valence_1.png'%}" class="guide_img" v-bind:style="{height: a_v_pic_width()}" style="display:block; margin: auto;"></img>
          </div>
          <div id="valance_images" class="col s10" style="position: relative; padding:0;">
            <div id="horizontal_axis" style="width: 100%; height:2px; position: absolute; background-color: #222222; top: 50%; z-index: 2;"></div>
            <div id="vertical_axis" style="height: 100%; width:2px; position: absolute; background-color: #222222; right: 50%; z-index: 2;"></div>
            <table>
              <tbody>
                <tr v-for="i in likert_range1">
                  <!--<td class="table_radios radios_padding"></td>-->
                  <td v-for="j in likert_range2" class="table_radios distribution_input_case" style="position: static;">
                    <div class="distribution_ex" v-bind:style="{height: 313/likert_scale+'px'}" v-bind:id="'ex_m_a'+(8-i)+'_v'+j"></div>
                    <!--<label v-bind:for="'a'+i+'_v'+j" class="radio_without_label"></label>-->
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="table_radios col s1" style="position: relative;" v-bind:style="{top: a_v_pic_top()}">
            <span style="display:block; margin: auto;">Positive</span>
            <img src="{%static 'img/valence_arousal/valence_5.png'%}" class="guide_img" v-bind:style="{width: a_v_pic_width()}" style="width: 100%; display:block; margin: auto;"></img>
          </div>
        </div>
        <div class="table_radios row" style="display:block; margin:auto; margin-top: 5px; margin-bottom: 5px;">
          <span style="display:block; margin: auto;">Calm</span>
          <img src="{%static 'img/valence_arousal/arousal_1.png'%}" class="guide_img" v-bind:style="{width: a_v_pic_width()}" style="display:block; margin: auto;"></img>
        </div>
      </div>
    </div>
    <div class="col s1" style="padding:0">
      <p style="font-size: 8pt; position: fixed; top: 150px;">Intensity of labels</p>
      <canvas v-bind:style="{top: bar_video_top()}" id="color_legend_ex" height="313" width="30" style="position:relative; display: block; margin: auto"></canvas>
    </div>
  </div>
  </div>
    <div class='modal-footer'>
    <span class='btn' v-on:click="prev()" v-if="cur_ex!=0">Prev</span>
    <span class='btn' v-on:click="next()" v-if="cur_ex+1!=target_second.length" :disabled="!nextable">Next</span>
    <span class='btn modal-action modal-close blue darken-2' v-on:click="escape_example()" :disabled="able_to_task()">To the task</span>
  </div>
</div>
{% endblock%}

{% block add_script%}
<script src="{% static 'js/example_module.js' %}"></script>
  <!-- TODO get example information -->
<script>
  var target_second = []
  var target_video_source = []
  var target_video_distribution = []
  var ex_video_m;

  // when to prompt examples while assigning labels
  var phase_info = [2, 5]
  // designate the current phase in the current time point
  cur_phase=0;
  var vue_exa_modal = new Vue({
    el: "#example",
    delimiters: ['[[', ']]'],
    data: {
      likert_scale: likert_scale,
      likert_range1: Array.apply(null, Array(likert_scale)).map(function (_, i) {return i+1;}),
      likert_range2: Array.apply(null, Array(likert_scale)).map(function (_, i) {return i+1;}),
      cur_ex:0,
      target_second: target_second,
      target_video_source: target_video_source,
      target_video_distribution: target_video_distribution,
      max_visited: 0,
      nextable: false,
      playing: false,
    },
    methods: {
      play_pause: function(){
        if(!ex_video_m.paused){
          this.playing = false;
          ex_video_m.pause()
        }else{
          this.playing = true;
          ex_video_m.play()
        }

      },
      to_beginning: function(){
        ex_video_m.currentTime = this.target_second[this.cur_ex]-5;
        ex_video_m.play()

      },
      next: function(){
        this.cur_ex++;
        if(this.max_visited<this.cur_ex){
          this.nextable = false
        }else{
          this.nextable = true
        }
        this.access_example(this.cur_ex)
      },
      prev: function(){
        this.cur_ex--;
        this.nextable=true
        this.access_example(this.cur_ex)
      },
      access_example: function(idx){
        this.cur_ex =idx;
        ex_video_m = video_update_blinking_and_stop("vd", this.target_second[this.cur_ex], 'vue_exa_modal')
        ex_video_m.src = this.target_video_source[this.cur_ex]
        ex_video_m.onpause=function(){
          vue_exa_modal.playing = false;
        }
        vue_app.color_distribution(av_array=this.target_video_distribution[this.cur_ex], grid_class='.distribution_ex', prepend="ex_m_")
        if(!ex_video_m.paused){
            ex_video_m.pause();
        }
        playing = false;
      },
      escape_example: function(){
        ex_video_m.pause()
      },
      h_axis_border: function(i, j){
        if(i==(this.likert_scale+1)/2 && j!=(this.likert_scale+1)/2){
          return true;
        }else{
          return false;
        }
      },
      v_axis_border: function(i, j){
        if(j==(this.likert_scale+1)/2 && i!=(this.likert_scale+1)/2){
          return true;
        }else{
          return false;
        }
      },
      a_v_pic_width: function(){
        return ($("#example").width()/3/12).toString()+'px';
      },
      bar_video_top: function(){
        return ($("#example").width()/3/6).toString()+'px';
      },
      a_v_pic_top: function(){
        return (313/2 - $("#example").width()/3/24).toString() + 'px';
      },
      selected_color: function(idx){
        if(idx==this.cur_ex){
          return "red"
        }else{
          return "teal"
        }

      },
      able_to_task: function(){
        return !(this.target_second.length == this.cur_ex+1 && this.nextable)
      }
    },
  })

  color_mapper_gradient_color('color_legend_ex')

  function update_example_from_backend(av_array){
    console.log(av_array)
    // TODO retrieve examples from the backend
    target_second = [10]
    target_video_source = Array.apply(null, Array(5)).map(function (_, i) {return 'https://firebasestorage.googleapis.com/v0/b/suggestbot-preprocessing.appspot.com/o/A%20Man%20Like%20You%20%20%20%20A%20Short%20Film%20from%20Harry%E2%80%99s.mp4?alt=media&token=8f79cbc2-ca80-498e-a262-5fad49191ecf';})
    target_video_distribution = Array.apply(null, Array(5)).map(function (_, k) {return Array.apply(null, Array(likert_scale)).map(function (_, i) {return Array.apply(null, Array(likert_scale)).map(function (_, j) {return Math.random()*i*j*i*i*j*j;});});})
    vue_app.target_second = target_second;
    vue_app.target_video_source = target_video_source;
    vue_app.target_video_distribution = target_video_distribution;
    vue_exa_modal.target_second = target_second;
    vue_exa_modal.target_video_source = target_video_source;
    vue_exa_modal.target_video_distribution = target_video_distribution;

    // TODO show the modal!
    vue_exa_modal.nextable = false
    vue_exa_modal.max_visited = 0
    vue_exa_modal.cur_ex = 0
    $("#example").modal('open')
    //initialize!
    vue_exa_modal.access_example(0)
    cur_phase++;
  }
  function clear_example(){
    vue_app.target_second = [];
    vue_app.target_video_source = [];
    vue_app.target_video_distribution = [];
    vue_exa_modal.target_second = [];
    vue_exa_modal.target_video_source = [];
    vue_exa_modal.target_video_distribution = [];
    cur_phase = 0;
  }

</script>
{% endblock %}
